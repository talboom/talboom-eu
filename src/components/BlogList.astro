---
import { getCollection } from 'astro:content';

export interface Props {
  variant?: 'home' | 'full' | 'featured';
  limit?: number;
}

const { variant = 'full', limit } = Astro.props;

// Get all blog posts from content collection
const allBlogPosts = await getCollection('blog');

// Map to consistent format and sort
const blogs = allBlogPosts
  .filter(post => post.data.published)
  .map(post => ({
    title: post.data.title,
    featured: post.data.featured,
    href: `/blog/${post.slug}`,
    description: post.data.description,
    introduction: post.data.introduction || post.data.description,
    date: post.data.date.toLocaleDateString('en-US', {
      year: 'numeric',
      month: 'long',
      day: 'numeric'
    }),
    published: post.data.published,
    image: post.data.image,
  }))
  .sort((a, b) => {
    // Sort by date, with featured posts first
    if (a.featured && !b.featured) return -1;
    if (!a.featured && b.featured) return 1;
    return new Date(b.date).getTime() - new Date(a.date).getTime();
  }); 

const displayBlogs = limit ? blogs.slice(0, limit) : blogs;
const featuredBlogs = limit ? blogs.filter(blog => blog.featured).slice(0,limit) : blogs.filter(blog => blog.featured);
const isHome = variant === 'home';
const isFeatured = variant === 'featured';
---

{isHome ? (
  <!-- Home page grid layout -->
  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    {displayBlogs.map(blog => (
      <div class="group">
        <h3 class="text-lg font-medium text-gray-900 mb-2">
          <a href={blog.href} class="hover:text-blue-600 transition-colors">
            {blog.title} →
          </a>
        </h3>
        <p class="text-gray-600 text-sm">
          {blog.description}
        </p>
      </div>
    ))}
  </div>
) : isFeatured ? (
  <!-- Featured Blog page list layout -->
  <div class="space-y-8">
    {featuredBlogs.map(blog => (
      <a href={blog.href} class="hover:text-blue-600 transition-colors">
        <article class="group flex gap-6 items-center">
            {blog.image && (
              <div class="hidden sm:block flex-[1]">
                <img
                  src={blog.image}
                  alt={blog.title}
                  class="w-full rounded-lg shadow-md object-cover aspect-square"
                />
              </div>
            )}
            <div class="flex-[3]">
              <h2 class="text-xl font-medium text-gray-900 mb-2">
                  {blog.title} →
              </h2>
              <p class="text-gray-600 mb-2">
                {blog.description}
              </p>
              <time class="text-sm text-gray-500">{blog.date}</time>
          </div>
        </article>
      </a>
    ))}
  </div>
) : (
  <!-- Full Blog page list layout -->
  <div class="space-y-8">
    {displayBlogs.map(blog => (
       <a href={blog.href} class="hover:text-blue-600 transition-colors">
        <article class="group flex gap-6 items-center">
            {blog.image && (
              <div class="hidden sm:block flex-[1]">
                <img
                  src={blog.image}
                  alt={blog.title}
                  class="w-full rounded-lg shadow-md object-cover aspect-square"
                />
              </div>
            )}
            <div class="flex-[3]">
              <h2 class="text-xl font-medium text-gray-900 mb-2">
                  {blog.title} →
              </h2>
              <p class="text-gray-600 mb-2">
                {blog.description}
              </p>
              <time class="text-sm text-gray-500">{blog.date}</time>
          </div>
        </article>
      </a>
    ))}
  </div>
)}